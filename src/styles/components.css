@layer components {
  .command-card {
    @apply bg-card rounded-lg border border-border shadow-md hover:shadow-lg transition-all duration-300;
  }
  .action-button {
    @apply bg-gradient-to-r from-primary to-primary/80 text-primary-foreground font-medium px-4 py-2 rounded-md shadow-md hover:shadow-[0_0_12px_rgba(136,217,206,0.5)] hover:brightness-110 transition-all duration-300;
  }
  .tab-button {
    @apply px-4 py-2 rounded-md transition-colors;
  }
  .tab-button.active {
    @apply bg-card shadow-md;
  }
  .ai-message {
    @apply bg-gradient-to-r from-primary to-primary/80 text-primary-foreground p-4 rounded-lg shadow-md;
  }
  .user-message {
    @apply bg-gradient-to-r from-secondary to-secondary/80 text-secondary-foreground p-4 rounded-lg shadow-md;
  }
  .status-badge {
    @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium;
  }
  .pulse-border {
    animation: pulseBorder 2s infinite;
  }
  .missions-card {
    @apply bg-card border border-border rounded-lg shadow-md hover:shadow-lg transition-all p-4;
  }
  .mindboard-card {
    @apply bg-card border border-border rounded-lg shadow-md hover:shadow-lg transition-all p-4;
  }
  .syncup-card {
    @apply bg-card border border-border rounded-lg shadow-md hover:shadow-lg transition-all p-4;
  }
  .actionbot-card {
    @apply bg-gradient-to-r from-card to-background border border-border/20 rounded-lg shadow-md hover:shadow-[0_0_15px_rgba(136,217,206,0.3)] transition-all;
  }
  
  /* Dark mode specific adjustments */
  [data-theme="dark"] .missions-card,
  [data-theme="dark"] .mindboard-card,
  [data-theme="dark"] .syncup-card {
    @apply shadow-[0_2px_8px_rgba(0,0,0,0.4)];
  }
  
  [data-theme="dark"] .action-button {
    @apply hover:shadow-[0_0_12px_rgba(0,247,239,0.4)];
  }
  
  [data-theme="dark"] .actionbot-card {
    @apply shadow-[0_2px_8px_rgba(0,0,0,0.4)] hover:shadow-[0_0_15px_rgba(0,247,239,0.2)];
  }

  /* Dropdown menu dark mode improvements */
  [data-theme="dark"] .dropdown-menu,
  [data-theme="dark"] .dropdown-menu-content,
  [data-theme="dark"] .radix-dropdown-menu__content {
    /* Pro-grade glass effect with perfect blending */
    @apply bg-gradient-to-br from-[#212e3e]/95 via-[#25384d]/97 to-[#314968]/95
           border border-[#3AF3EF]/30 shadow-[0_4px_28px_8px_rgba(0,247,239,0.15)]
           backdrop-blur-xl text-foreground;
    box-shadow: 0 2px 24px 4px rgba(0,247,239,0.14), 0 4px 38px 0px rgba(33, 46, 62, 0.58);
    border-width: 1.5px;
    border-radius: 1rem;
    background-blend-mode: lighten;
    background-color: transparent !important;
    transition: all 0.38s cubic-bezier(0.41,0.1,0.59,1);
  }

  /* Card and popover blending for dark mode */
  [data-theme="dark"] .card,
  [data-theme="dark"] .mindboard-card,
  [data-theme="dark"] .missions-card,
  [data-theme="dark"] .actionbot-card,
  [data-theme="dark"] .syncup-card {
    @apply bg-gradient-to-br from-[#25384D]/95 via-[#314968]/95 to-[#1b2635]/90
           border border-[#3A4D62]/70 shadow-[0_2px_8px_rgba(0,0,0,0.45)] backdrop-blur-md;
  }

  /* Glassmorphism Popover/Dropdown for Dark Mode */
  [data-theme="dark"] .popover,
  [data-theme="dark"] .sheet-content,
  [data-theme="dark"] .profile-menu {
    @apply bg-gradient-to-br from-[#232f43]/97 via-[#25384D]/92 to-[#314968]/85
           border border-[#3AF3EF]/25 shadow-[0_4px_32px_4px_rgba(0,247,239,0.14)]
           backdrop-blur-xl text-foreground;
    border-radius: 1rem !important;
    background-blend-mode: lighten;
    transition: all 0.38s cubic-bezier(0.41,0.1,0.59,1);
  }

  /* Focus state for selection (neon/bright glass highlight) */
  [data-theme="dark"] .dropdown-menu [data-highlighted],
  [data-theme="dark"] .dropdown-menu-content [data-highlighted] {
    @apply bg-[#00f7ef]/20 text-neon-aqua;
    box-shadow: 0 0 8px 0 rgba(0, 247, 239, 0.3);
    border-radius: 0.5rem;
  }
  
  /* Remove any hard borders or solid fills in popover dropdowns */
  [data-theme="dark"] .dropdown-menu *,
  [data-theme="dark"] .dropdown-menu-content * {
    background-color: transparent !important;
  }
  
  /* Better padding for dropdown menus */
  [data-theme="dark"] .dropdown-menu,
  [data-theme="dark"] .dropdown-menu-content,
  [data-theme="dark"] .radix-dropdown-menu__content,
  [data-theme="dark"] .profile-menu {
    padding: 0.75rem 0.5rem !important;
    min-width: 12rem;
  }
  
  /* No transparency for menu overlay */
  [data-theme="dark"] .DropdownMenu__overlay {
    background: rgba(28,38,52,0.01) !important;
    backdrop-filter: blur(2px);
    z-index: 9998;
  }

  /* Smooth transitions for menus */
  .dropdown-menu,
  .dropdown-menu-content {
    transition: all 0.32s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Transition improvements */
  .theme-transition * {
    @apply transition-all duration-300;
  }

  /* Button hover effect for dark mode */
  [data-theme="dark"] .hover-button {
    @apply hover:bg-[#00f7ef]/10 rounded-md transition-colors duration-200;
    padding: 0.5rem !important;
    margin: 0 0.25rem !important;
  }

  /* Modal and dropdown transitions for dark mode */
  [data-theme="dark"] .modal-overlay {
    @apply bg-black/60 backdrop-blur-sm transition-opacity duration-300;
  }
  
  /* Improved glow effects for dark mode */
  [data-theme="dark"] .glow-effect {
    @apply shadow-[0_0_15px_rgba(0,247,239,0.15)] hover:shadow-[0_0_20px_rgba(0,247,239,0.25)] transition-shadow duration-300;
  }

  /* Glassmorphism header for Dark Mode */
  [data-theme="dark"] .header {
    background: linear-gradient(to bottom, rgba(37, 56, 77, 0.95), rgba(37, 56, 77, 0.9));
    border-bottom: 1px solid rgba(58, 77, 98, 0.5);
    backdrop-filter: blur(10px);
    box-shadow: 0 1px 10px 0 rgba(0, 0, 0, 0.1);
  }

  /* Theme smooth transitions for all interactive components */
  .theme-transition, .theme-transition * {
    transition: background-color 0.3s ease, 
                color 0.3s ease, 
                border-color 0.3s ease, 
                box-shadow 0.3s ease,
                filter 0.3s ease,
                backdrop-filter 0.3s ease;
  }

  /* Custom avatar styling for dark mode */
  [data-theme="dark"] .avatar-fallback {
    background: linear-gradient(135deg, rgba(36, 62, 84, 0.9), rgba(49, 73, 104, 0.8)) !important;
    border: 1px solid rgba(58, 243, 239, 0.2);
    color: rgba(217, 233, 231, 0.9);
  }
}

/* Fix for dropdown menu positioning - ensure highest z-index */
[data-radix-popper-content-wrapper] {
  z-index: 99999 !important; 
  position: fixed !important;
}

/* Fix for dropdown menu hover effects */
.dropdown-menu-item:hover {
  background-color: rgba(0, 247, 239, 0.1);
  border-radius: 0.375rem;
}

/* Extra fixes for stacking context and positioning */
.radix-dropdown-menu {
  z-index: 99999;
}

/* Fix for profile menu position to avoid overlaps */
.profile-menu {
  margin-top: 5px !important;
  transform: translateY(0) !important;
  border-radius: 14px !important;
}

/* Prevent overlap with Open in Notion button */
.DropdownMenuContent {
  margin-top: 8px !important;
}

/* Explicitly set the dropdown menu position */
[data-radix-popper-content-wrapper] {
  top: auto !important;
  transform: none !important;
}

/* --- ENHANCED PROFILE DROPDOWN MENU BLEND --- */
.profile-menu, .dropdown-menu-content, .radix-dropdown-menu__content {
  min-width: 13rem !important;
  margin-top: 14px !important;
  border-radius: 1.1rem !important;
  box-shadow:
    0 2px 24px 2px rgba(0,247,239,0.10),
    0 10px 32px 0 rgba(37,56,77,0.25),
    0 0.5px 3px 0 rgba(33,46,62,0.12);
  border: 1.5px solid var(--border, #3A4D62);
  /* Fallback in case var fails */
  border-color: #3A4D621C;
  transition:
    background 0.42s cubic-bezier(0.55,0.13,0.47,0.98),
    box-shadow 0.42s cubic-bezier(0.55,0.13,0.47,0.98);
  backdrop-filter: blur(18px) saturate(1.01);
  -webkit-backdrop-filter: blur(18px) saturate(1.01);
  overflow: visible !important;
}

/* DARK MODE GLASS BLEND FOR PROFILE MENUS */
[data-theme="dark"] .profile-menu,
[data-theme="dark"] .dropdown-menu-content,
[data-theme="dark"] .radix-dropdown-menu__content {
  background:
    linear-gradient(127deg,
      rgba(33, 46, 62, 0.97) 14%,
      rgba(37, 56, 77, 0.94) 55%,
      rgba(49, 73, 104, 0.89) 100%
    ),
    radial-gradient(farthest-corner at 64% 5%,rgba(0,247,239,0.12) 4%,rgba(58,243,239,0.13) 90%);
  box-shadow:
    0 2px 28px 12px rgba(0,247,239,0.13),
    0 2px 40px 0px rgba(33, 46, 62, 0.75);
  border: 1.5px solid #3AF3EF55;
  /* Glow highlight for active/focused menu item */
}
[data-theme="dark"] .profile-menu,
[data-theme="dark"] .dropdown-menu-content {
  color: #D9E9E7;
}

/* LIGHT MODE: Soft glass look, but robust contrast */
[data-theme="light"] .profile-menu,
[data-theme="light"] .dropdown-menu-content,
[data-theme="light"] .radix-dropdown-menu__content {
  background:
    linear-gradient(138deg,
      rgba(245, 247, 250, 0.97) 18%,
      rgba(213, 225, 238, 0.91) 62%,
      rgba(255,255,255,0.96) 97%
    ),
    linear-gradient(114deg,rgba(136,217,206,0.07) 46%,rgba(33,46,62,0.03) 80%);
  box-shadow:
    0 1.5px 20px 3px rgba(136,217,206,0.12),
    0 12px 28px 0 rgba(60,80,97,0.15);
  border: 1.5px solid #BFBFBF33;
  color: #222;
}

.profile-menu {
  /* Extra lift */
  z-index: 100010 !important;
  margin-top: 12px !important;
  padding: 0.8rem 0.7rem !important;
}

.dropdown-menu-content {
  z-index: 100001 !important;
  margin-top: 12px !important;
  padding: 0.85rem 0.7rem !important;
}

/* Profile menu specific focus: neon highlight ring */
[data-theme="dark"] .profile-menu [data-highlighted],
[data-theme="dark"] .dropdown-menu-content [data-highlighted] {
  background: linear-gradient(98deg, #00f7ef22 50%, #25384D 100%);
  color: #00F7EF !important;
  box-shadow: 0 0 12px 0 rgba(0,247,239,0.23);
  border-radius: 0.7rem;
}

/* Light mode focus: teal-blue soft highlight */
[data-theme="light"] .profile-menu [data-highlighted],
[data-theme="light"] .dropdown-menu-content [data-highlighted] {
  background: linear-gradient(86deg, #e8fcfa 55%, #c2e9e3 100%);
  color: #184842 !important;
  border-radius: 0.65rem;
}

/* Dropdown item hover always crisp */
.dropdown-menu-item:hover,
.profile-menu [role="menuitem"]:hover {
  background-color: rgba(136,217,206,0.13) !important;
  color: #264E46 !important;
  border-radius: 0.7rem;
}

/* Sandwich menu: fix possible margin for sheet/mobile! */
@media (max-width: 768px) {
  .profile-menu, .dropdown-menu-content, .radix-dropdown-menu__content {
    margin-top: 10px !important;
    min-width: 97vw !important;
    left: 0 !important;
    right: 0 !important;
    border-radius: 1.15rem !important;
  }
}

/* Ensures dropdown never overlap any floating "Open in Notion" */
.DropdownMenuContent {
  margin-top: 18px !important;
  z-index: 100003 !important;
  border-radius: 1.2rem !important;
}

/* --- END UI ENHANCEMENT FOR PROFILE & USER MENU --- */
